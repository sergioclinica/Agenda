@model Agenda.Models.Turno

@{
    ViewBag.Title = "Asignación de Turnos";
}

<div class="row">
    <div class="col s6">
        <label asp-for="IdMedico">Médico</label>
        <select asp-for="IdMedico" asp-items="ViewBag.IdMedico"></select>
    </div>
    <div class="col s6">
        <label asp-for="IdPaciente">Peciente</label>
        <select asp-for="IdPaciente" asp-items="ViewBag.IdPaciente"></select>
    </div>
</div>
<br />
<div id="CalendarioTurnos"></div>

<link href="~/fullcalendar/fullcalendar.css" rel="stylesheet" />
<link href="~/fullcalendar/fullcalendar.print.css" rel="stylesheet" media="print" />

@section Scripts{
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
    <script src="~/fullcalendar/fullcalendar.min.js"></script>
    <script src="~/fullcalendar/locale/es.js"></script>

    <script>
        $(document).ready(function () {
            var horarioDesde = "";
            var horarioHasta = "";

            $.ajax({
                type: "get",
                url: "Medico/TraerHorarioAtencionDesde",
                data: { "IdMedico": $("#IdMedico").val() },
                async: false,
                success: function(resultado){
                    horarioDesde = resultado;
                },
                error: function(){
                    alert("Error al traer los datos de TraerHorarioAtencionDesde");
                }
            });

            $.ajax({
                type: "get",
                url: "Medico/TraerHorarioAtencionHasta",
                data: { "IdMedico": $("#IdMedico").val() },
                async: false,
                success: function (resultado) {
                    horarioHasta = resultado;
                },
                error: function () {
                    alert("Error al traer los datos de TraerHorarioAtencionHasta");
                }
            });

            $('#CalendarioTurnos').fullCalendar({
                contentHeight: 'auto',
                defaultDate: new Date(), // es la fecha que va sobre el calendario
                slotLabelFormat: 'HH:mm',
                defaultView: 'agendaWeek', // 'agendaDay'
                header: {
                    left: 'prev,next today',
                    right: 'month,agendaWeek,agendaDay',
                    center: 'title', // despliega el titulo con la fecha al centro sobre el calendario
                },
                slotDuration: '00:30',
                nowIndicator: true,
                allDaySlot: false,
                selctable: true,
                eventLimit: true, // por ejemplo tiempo máximo por evento 30 min

                // Video "14. Funciones AJAX horarios de atención PARTE 1"
                minTime: horarioDesde, // ejem '09:00',
                maxTime: horarioHasta, // ejem'20:00',
                //minTime: '09:00',
                //xTime: '20:00',
                hiddenDays: [0, 6], // esconde el 0=Domingo y 6=Sabado
            });
        });
    </script>
}
